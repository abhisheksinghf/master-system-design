---
title: Delivery Semantics
sidebar_label: "5.3 Delivery Semantics"
description: Understanding at-most-once, at-least-once, and exactly-once delivery guarantees in distributed messaging systems
---

# Delivery Semantics

> Goal: Understand different message delivery guarantees and how they impact reliability, duplication, and system design.

---

## 5.3.1 Why Delivery Semantics Matter ⭐⭐⭐⭐⭐

In distributed systems:
- Networks fail
- Consumers crash
- Messages may be retried

So the key question is:

> How many times will a message be delivered?

Delivery semantics define that guarantee.

---

# 5.3.2 At-Most-Once Delivery

## Definition

Message is delivered:
- Zero or one time
- Never more than once

If failure occurs:
- Message may be lost

```mermaid
sequenceDiagram
    Producer->>Queue: Send
    Queue-->>Consumer: Deliver
    Consumer (crashes before processing)
    Message lost
````

---

## Characteristics

* No retries
* No duplicates
* Possible data loss

### Use Case

* Non-critical logging
* Metrics collection

> Prioritizes performance over reliability.

---

# 5.3.3 At-Least-Once Delivery ⭐⭐⭐⭐⭐

## Definition

Message is delivered:

* One or more times
* Never lost

If consumer crashes:

* Message retried

```mermaid
sequenceDiagram
    Producer->>Queue: Send
    Queue-->>Consumer: Deliver
    Consumer (crashes before ACK)
    Queue-->>Consumer: Redeliver
```

---

## Characteristics

* No data loss
* Duplicates possible
* Requires idempotent consumers

### Most Common Guarantee

> Most real-world systems use at-least-once delivery.

---

# 5.3.4 Exactly-Once Delivery ⭐⭐⭐⭐

## Definition

Message is delivered:

* Exactly one time
* No duplicates
* No loss

---

## Why It Is Hard

To achieve exactly-once:

* Need idempotency
* Need deduplication
* Need transaction coordination
* Often requires distributed transactions

---

## Trade-Off

* Complex
* Slower
* Expensive
* Hard in distributed systems

> Exactly-once is conceptually simple but technically complex.

---

# 5.3.5 Idempotency (Very Important) ⭐⭐⭐⭐⭐

A function is idempotent if:

```
f(x) = f(f(x))
```

Meaning:
Processing the same message twice produces the same result.

Example:

* Mark order as “completed”
* If already completed → no change

> Idempotency is mandatory for at-least-once systems.

---

# 5.3.6 Comparing Delivery Semantics ⭐⭐⭐⭐⭐

| Guarantee     | Loss Possible | Duplicates Possible | Complexity |
| ------------- | ------------- | ------------------- | ---------- |
| At-Most-Once  | Yes           | No                  | Low        |
| At-Least-Once | No            | Yes                 | Medium     |
| Exactly-Once  | No            | No                  | High       |

---

# 5.3.7 Real-World Example (Payment System)

### Payment Processing

* Must not lose message
* Must avoid double charge

Solution:

* Use at-least-once
* Make processing idempotent

> Idempotency protects against duplicates.

---

# 5.3.8 Common Interview Mistakes ❌

❌ Assuming exactly-once is easy
❌ Ignoring idempotency
❌ Confusing reliability with ordering
❌ Forgetting retry behavior

✅ Correct thinking:

* At-least-once is most common
* Idempotent consumers are essential
* Exactly-once is expensive

---

# Key Takeaways ⭐⭐⭐⭐⭐

* Delivery semantics define reliability guarantees
* At-most-once may lose messages
* At-least-once may duplicate messages
* Exactly-once is complex
* Idempotency is critical

---

# Interview-Ready One-Liners ⭐

* “Most systems use at-least-once delivery.”
* “Idempotent consumers prevent duplicate side effects.”
* “Exactly-once is expensive and complex.”
* “Delivery guarantees trade reliability for performance.”