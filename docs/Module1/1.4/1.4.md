---
title: CAP Theorem
sidebar_label: "1.4 CAP Theorem"
description: Understanding Consistency, Availability, and Partition Tolerance in distributed systems
---

# CAP Theorem

> Goal: Understand the fundamental trade-offs in distributed systems and how real-world systems choose between Consistency and Availability.

---

## 1.4.1 What Is the CAP Theorem?

The **CAP Theorem** states that **in a distributed system**, you can guarantee **at most two** of the following three properties **at the same time**:

- **Consistency (C)**
- **Availability (A)**
- **Partition Tolerance (P)**

```mermaid
graph TD
    C[Consistency]
    A[Availability]
    P[Partition Tolerance]

    C --- A
    A --- P
    C --- P
````

> You can choose **any two**, but **never all three**.

---

## 1.4.2 Why CAP Theorem Exists

In distributed systems:

* Nodes run on different machines
* Network failures are inevitable
* Messages can be delayed or lost

ğŸ‘‰ **Network partition is not optional** â€” it *will* happen.

Therefore:

> **Partition Tolerance is mandatory** in real distributed systems.

---

## 1.4.3 The Three CAP Properties Explained

---

### Consistency (C)

**Definition**
Every read receives the **most recent write**.

Example:

* User updates email
* Immediately reads profile
* Always sees updated email

```mermaid
sequenceDiagram
    Client->>Node1: Write X=10
    Client->>Node2: Read X
    Node2-->>Client: X=10
```

âœ” Strong data correctness
âŒ Higher latency, reduced availability during failures

---

### Availability (A)

**Definition**
Every request receives a response (success or failure), even during failures.

Example:

* System always responds
* Might return stale data

```mermaid
sequenceDiagram
    Client->>Node1: Read X
    Node1-->>Client: X=9
```

âœ” System is always responsive
âŒ Data may be stale or inconsistent

---

### Partition Tolerance (P)

**Definition**
The system continues to operate despite **network failures** between nodes.

Example:

* Data centers cannot communicate
* System must still function

```mermaid
graph LR
    DC1[Data Center 1] -. network partition .- DC2[Data Center 2]
```

âœ” Mandatory for distributed systems
âŒ Forces trade-offs between C and A

---

## 1.4.4 Why You Canâ€™t Have C, A, and P Together

During a **network partition**, the system must choose:

### Option 1: Consistency over Availability (CP)

* Reject requests to maintain correctness
* Some users get errors

### Option 2: Availability over Consistency (AP)

* Always respond
* Data may be stale

```mermaid
flowchart TD
    P[Network Partition Occurs]
    P -->|Choose Consistency| CP[Reject Requests]
    P -->|Choose Availability| AP[Return Possibly Stale Data]
```

> This decision defines your systemâ€™s CAP category.

---

## 1.4.5 CP Systems (Consistency + Partition Tolerance)

### Characteristics

* Strong consistency
* May reject requests during partitions

### Examples

* Banking systems
* Payment systems
* Distributed databases with quorum

âœ” Correct data
âŒ Lower availability during failures

---

## 1.4.6 AP Systems (Availability + Partition Tolerance)

### Characteristics

* Always respond
* Eventual consistency

### Examples

* Social media feeds
* Caching systems
* DNS

âœ” High availability
âŒ Temporary inconsistency

---

## 1.4.7 CA Systems â€“ Why They Donâ€™t Exist at Scale

### CA = Consistency + Availability

* Works **only if no partition**
* Not realistic in distributed systems

Example:

* Single-node database
* Single data center system

> Once you distribute the system, **CA is no longer possible**.

---

## 1.4.8 CAP in Real-World Systems (IMPORTANT)

| System Type       | CAP Choice | Reason                     |
| ----------------- | ---------- | -------------------------- |
| Payment systems   | CP         | Correctness > availability |
| Banking ledger    | CP         | No stale data allowed      |
| Social media feed | AP         | Availability > consistency |
| Cache (Redis)     | AP         | Fast responses             |
| DNS               | AP         | Must always respond        |

---

## 1.4.9 CAP Is Not a Static Choice (Very Important Insight)

Modern systems are:

* **Mostly AP**
* **Selectively CP**

Example:

* Show cached feed (AP)
* Write comment with strong consistency (CP)

> CAP choices can be **operation-specific**, not system-wide.

---

## 1.4.10 Common CAP Misconceptions âŒ

âŒ â€œCAP means you choose two foreverâ€
âŒ â€œAP systems are wrongâ€
âŒ â€œConsistency means immediate sync everywhereâ€

âœ… Reality:

* CAP applies **only during partitions**
* Systems mix strategies
* Consistency has levels

---

## 1.4.11 CAP and Latency Relationship

* Strong consistency â†’ more coordination â†’ higher latency
* Availability â†’ faster responses â†’ possible staleness

> CAP decisions directly affect **latency and user experience**.

---

## Key Takeaways â­â­â­â­â­

* Network partitions are unavoidable
* Partition tolerance is mandatory
* During partition: choose **C or A**
* CP â†’ correctness
* AP â†’ availability
* Real systems mix both

---

## Interview-Ready One-Liners â­

* â€œCAP trade-offs occur only during network partitions.â€
* â€œPartition tolerance is mandatory in distributed systems.â€
* â€œPayments prefer CP, feeds prefer AP.â€
* â€œModern systems make CAP decisions per operation.â€

---

## References & Deep-Dive Resources

### Articles

* [https://www.geeksforgeeks.org/cap-theorem-in-distributed-system/](https://www.geeksforgeeks.org/cap-theorem-in-distributed-system/)
* [https://www.ibm.com/topics/cap-theorem](https://www.ibm.com/topics/cap-theorem)
* [https://martinfowler.com/articles/patterns-of-distributed-systems/](https://martinfowler.com/articles/patterns-of-distributed-systems/)

### Videos

* [https://www.youtube.com/watch?v=k-Yaq8AHlFA](https://www.youtube.com/watch?v=k-Yaq8AHlFA) (CAP Theorem Explained)
* [https://www.youtube.com/watch?v=1Cw1y9z0S6E](https://www.youtube.com/watch?v=1Cw1y9z0S6E) (CAP with Examples)

### Books

* *Designing Data-Intensive Applications* â€“ Martin Kleppmann
* *Distributed Systems* â€“ Tanenbaum

---
